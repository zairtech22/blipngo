<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Blipngo — Businesses</title>
  <style>
    :root{ --ink:#0A0A0A; --muted:#6b7280; --bg:#f6f7f8; --paper:#fff; --border:#e5e7eb; --brand:#111827; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}

    header{position:sticky;top:0;z-index:20;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:16px 20px;background:#fff;border-bottom:1px solid var(--border)}
    h1{margin:0;font-size:18px}
    .hint{color:var(--muted);font-size:12px}
    .btn{border:2px solid #000;background:#fff;color:#000;padding:8px 12px;border-radius:10px;font-weight:700;text-decoration:none;display:inline-block;cursor:pointer}
    .btn:hover{background:#000;color:#fff}
    .btn.secondary{border-color:#888;color:#222}
    .btn.danger{border-color:#b00;color:#b00}.btn.danger:hover{background:#b00;color:#fff}

    main{max-width:1100px;margin:0 auto;padding:20px;display:grid;gap:16px}

    .card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px}
    .card h3{margin:0 0 10px 0;font-size:16px}

    /* Table */
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{text-align:left;padding:10px 12px}
    thead th{font-size:12px;color:var(--muted);font-weight:700}
    tbody tr{background:#fff;border:1px solid var(--border)}
    tbody tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
    tbody tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}

    /* Register panel (hidden by default) */
    .panel{background:#fff;border:1px solid var(--border);border-radius:14px;overflow:hidden}
    .panel-head{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border)}
    .panel-body{padding:16px;display:grid;gap:12px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;margin:6px 0 6px;font-weight:700}
    input[type="text"],input[type="url"],input[type="color"],textarea,select{
      width:100%;padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;font:inherit
    }
    textarea{resize:vertical;min-height:100px}

    .hidden{display:none}
    .savebar{padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:10px;background:#fff}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>BlipNGo</h1>
      <div class="hint">Online Reputation Managemnet in a blip.</div>
    </div>
    <div>
      <button id="openRegister" class="btn" aria-expanded="false" aria-controls="registerPanel">Register Business</button>
    </div>
  </header>

  <main>
    <!-- Business list first -->
    <section class="card">
      <h3>Registered Business</h3>
      <% if (!businesses || businesses.length === 0) { %>
        <div class="hint">No businesses yet. Click “Register Business” to add your first one.</div>
      <% } else { %>
        <table>
          <thead>
          <tr>
            <th style="width:28%">Name</th>
            <th style="width:22%">Slug</th>
            <th style="width:22%">Created</th>
            <th style="width:28%">Actions</th>
          </tr>
          </thead>
          <tbody>
          <% businesses.forEach(b => { %>
            <tr>
              <td><strong><%= b.name %></strong></td>
              <td><code><%= b.slug %></code></td>
              <td><%= new Date(b.createdAt).toLocaleString() %></td>
              <td>
                <div class="actions">
                  <a class="btn" href="/business/<%= b.slug %>">Manage</a>
                  <a class="btn secondary" href="/p/<%= b.slug %>" target="_blank">Public</a>
                  <form method="post" action="/business/<%= b.slug %>/delete" onsubmit="return confirm('Delete this business?')">
                    <button class="btn danger" type="submit">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          <% }) %>
          </tbody>
        </table>
      <% } %>
    </section>

    <!-- Hidden Register panel -->
    <section id="registerPanel" class="panel hidden" aria-hidden="true">
      <div class="panel-head">
        <strong>Register a New Business</strong>
        <button id="closeRegister" class="btn secondary" aria-label="Close register form">Close</button>
      </div>
      <form method="post" action="/business">
        <div class="panel-body">
          <div class="row">
            <div>
              <label>Business Name</label>
              <input required name="name" type="text" placeholder="Blazin Halal"/>
            </div>
            <div>
              <label>Custom Slug (optional)</label>
              <input name="slug" type="text" placeholder="blazin-halal"/>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Logo URL</label>
              <input name="logoUrl" type="url" placeholder="https://…/logo.png"/>
            </div>
            <div>
              <label>Poster Background Color</label>
              <input name="brandColor" type="text" value="#FFD21E"/>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Instagram URL</label>
              <input name="instagramUrl" type="url" placeholder="https://instagram.com/…"/>
            </div>
            <div>
              <label>TikTok URL</label>
              <input name="tiktokUrl" type="url" placeholder="https://tiktok.com/@…"/>
            </div>
          </div>

          <div class="row">
            <div>
              <label>YouTube URL</label>
              <input name="youtubeUrl" type="url" placeholder="https://youtube.com/@…"/>
            </div>
            <div>
              <label>Google Review URL</label>
              <input name="googleReviewUrl" type="url" placeholder="https://search.google.com/local/writereview?placeid=…"/>
            </div>
          </div>

          <div>
            <label>Steps (one per line)</label>
            <textarea name="steps" placeholder="Scan the QR&#10;Follow us on IG/TikTok/YouTube&#10;Show screen to staff for perk"></textarea>
          </div>

          <input type="hidden" name="showLogo" value="on"/>
          <input type="hidden" name="qrLayout" value="vertical"/>
          <input type="hidden" name="ctaBgColor" value="#0A0A0A"/>
        </div>
        <div class="savebar">
          <button class="btn" type="submit">Create Business</button>
        </div>
      </form>
    </section>
  </main>

  <script>
    (function(){
      const openBtn = document.getElementById('openRegister');
      const closeBtn = document.getElementById('closeRegister');
      const panel   = document.getElementById('registerPanel');

      <div class="footer">© <script>document.write(new Date().getFullYear())</script> BlipNGo</div>
    </div>
  </body>
</html>
